(()=>{"use strict";function e(e,t,o,n,r,c,a,i,u){var s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__image");return s.id=e._id,l.src=e.link,l.alt="пейзаж из "+e.name,s.querySelector(".card__title").textContent=e.name,s.querySelector(".card__likes-counter").textContent=e.likes.length,a&&s.querySelector(".card__like-button").classList.add("card__like-button_is-active"),u&&(s.querySelector(".card__delete-button").style.visibility="visible"),s.addEventListener("click",(function(e){e.target.classList.contains("card__like-button")?(e.target.classList.contains("card__like-button_is-active")?c(e.currentTarget,".card__likes-counter"):r(e.currentTarget,".card__likes-counter"),n(e)):e.target.classList.contains("card__delete-button")?(o(e.currentTarget.id),t(e)):e.target.classList.contains("card__image")&&i(e)})),s}function t(e){e.target.closest(".card").remove()}function o(e){e.target.classList.contains("card__like-button")&&e.target.classList.toggle("card__like-button_is-active")}var n,r=function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},c=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},a=function(e){var t=e.querySelector(n.formSelector);if(null!==t){var o=Array.from(t.querySelectorAll(n.errorClass)),c=t.querySelector(n.submitButtonSelector),a=Array.from(t.querySelectorAll(n.inputSelector));o.forEach((function(e){r(t,e)})),a.forEach((function(e){t.elements[e.getAttribute("name")].value=""})),c.classList.remove(n.inputErrorClass.inactiveButtonClass)}};function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s),a(e)}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function s(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}var l,d="https://nomoreparties.co/v1/wff-cohort-23/cards/likes/",p="f67b98a7-6c15-45e9-9b9f-f262fc587873",f=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),_=document.querySelector(".profile__image"),h=document.querySelector(".places__list");function v(e){return fetch("https://nomoreparties.co/v1/wff-cohort-23/cards/"+e,{method:"DELETE",headers:{authorization:p}}).catch((function(e){console.log(e)}))}function y(e,t){return fetch(d+"/"+e.id,{method:"PUT",headers:{authorization:p}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(o){e.querySelector(t).textContent=o.likes.length})).catch((function(e){console.log("Error. CardID: "+cardID),console.log("error: ".concat(e))}))}function g(e,t){return fetch(d+"/"+e.id,{method:"DELETE",headers:{authorization:p}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(o){e.querySelector(t).textContent=o.likes.length})).catch((function(e){console.log("Error. CardID: "+cardID),console.log("error: ".concat(e))}))}var S=document.querySelector(".content"),q=S.querySelector(".places__list"),b=document.querySelectorAll(".popup"),C=S.querySelector(".profile__edit-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),x=document.querySelector(".profile__image-hover"),T=document.querySelector(".popup_type_new-avatar"),w=document.forms["new-avatar"],j=document.querySelector(".popup_type_edit"),A=document.forms["edit-profile"],P=S.querySelector(".profile__add-button"),D=document.querySelector(".popup_type_new-card"),z=document.forms["new-place"],B=document.querySelector(".popup_type_image"),I=B.querySelector(".popup__image"),N=B.querySelector(".popup__caption"),O=[{selector:C,popupElement:j},{selector:P,popupElement:D},{selector:x,popupElement:T}],J=[],H="https://nomoreparties.co/v1/wff-cohort-23/cards",M="f67b98a7-6c15-45e9-9b9f-f262fc587873";function U(e){e.target.classList.contains("card__image")&&(I.src=e.currentTarget.querySelector(".card__image").src,I.alt=e.currentTarget.querySelector(".card__image").alt,N.textContent=e.currentTarget.querySelector(".card__title").textContent,u(B))}function F(e){var t=e.querySelector(".button__submit");t.classList.toggle("saving"),t.classList.contains("saving")?(t.textContent="Сохранение...",t.classList.add("popup__button_disabled")):(t.textContent="Cохранить",t.classList.remove("popup__button_disabled"))}J.push({element:D,handler:function(n){n.preventDefault(),F(z);var r,c,a,u,s={name:z.elements["place-name"].value,link:z.elements.link.value,likes:0};q.prepend(e(s,t,v,o,y,g,!1,U,!0)),(r=H,c=M,a=s.name,u=s.link,fetch(r,{method:"POST",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:a,link:u})}).then((function(e){if(!e.ok)return Promise.reject(e.status);console.log("image has been loaded")})).catch((function(e){console.log(e)}))).then((function(){F(z),i(D)}))}}),J.push({element:j,handler:function(e){var t,o,n;e.preventDefault(),F(A),(t=M,o=k.textContent,n=E.textContent,fetch("https://nomoreparties.co/v1/wff-cohort-23/users/me",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})})).then((function(){k.textContent=A.elements.name.value,E.textContent=A.elements.description.value,i(j),F(A)})).catch((function(e){console.log(e)}))}}),J.push({element:T,handler:function(e){e.preventDefault(),F(w);var t,o=w.elements["avatar-link"].value;new Promise((function(e,t){var n=new Image;n.addEventListener("load",e),n.addEventListener("error",t),n.src=o})).then((t=o,fetch("https://nomoreparties.co/v1/wff-cohort-23/users/me/avatar",{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){if(!e.ok)return Promise.reject(e.status)})).catch((function(e){console.log(e)})))).then((function(){L.style.backgroundImage="url(".concat(o,")"),F(w),i(T)})).catch((function(e){console.log(e)}))}}),O.forEach((function(e){e.selector.addEventListener("click",(function(t){if(e.popupElement.classList.contains("popup_type_edit")){var o=document.querySelector(".profile__title"),n=document.querySelector(".profile__description");A.elements.name.value=o.textContent,A.elements.description.value=n.textContent}u(e.popupElement)}))})),b.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target===e.currentTarget)&&i(e.currentTarget)}))})),J.forEach((function(e){e.element.addEventListener("submit",e.handler)})),n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(n.formSelector)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(n.inputSelector));c(t,e.querySelector(n.submitButtonSelector)),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.valid?r(e,t):function(e,t,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage)})(e,o),c(t,e.querySelector(n.submitButtonSelector))}))}))}(e)})),fetch("https://nomoreparties.co/v1/wff-cohort-23/users/me",{headers:{authorization:p}}).then((function(e){return e.json()})).then((function(e){f.textContent=e.name,m.textContent=e.about,_.style.backgroundImage="url(".concat(e.avatar,")"),l=e._id})).catch((function(e){console.log(e)})).then(function(n,r,c){return fetch(n,{headers:{authorization:r}}).then((function(e){return e.json()})).then((function(n){n.forEach((function(n){fetch(n.link).then((function(e){return e.ok?void 0:Promise.reject(e.status)})).then((function(){var r;r=n.likes.some((function(e){return e._id===l})),h.append(e(n,t,v,o,y,g,r,c,n.owner._id===l))})).catch((function(e){console.log("error ".concat(e))}))}))})).catch((function(e){console.log(e)}))}(H,M,U)).then((function(){console.log("Startup download from server has been finished.")})).catch((function(e){console.error(e)}))})();