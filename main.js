(()=>{"use strict";function e(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image");c.id=e._id,i.src=e.link,i.alt="пейзаж из "+e.name,c.querySelector(".card__title").textContent=e.name,c.querySelector(".card__likes-counter").textContent=e.likes.length;var u=e.owner._id===r;return u&&(c.querySelector(".card__delete-button").style.visibility="visible",e.likes.some((function(e){return e._id===r}))&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active")),c.addEventListener("click",(function(e){e.target.classList.contains("card__like-button")?n(e.currentTarget):e.target.classList.contains("card__delete-button")&&u?t(e.currentTarget):e.target.classList.contains("card__image")&&o(e)})),c}function t(e){e.remove()}function n(e){e.classList.contains("card__like-button")&&e.classList.toggle("card__like-button_is-active")}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function c(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}var i,u="https://nomoreparties.co/v1/wff-cohort-23",a=u+"/users/me",l=a+"/avatar",s=u+"/cards",d=s+"/likes",p="f67b98a7-6c15-45e9-9b9f-f262fc587873";function f(e){return e.ok?e.json():Promise.reject(e.status)}function _(e){e.disabled=!0,e.classList.add(i.inactiveButtonClass)}var m,h=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(i.inputErrorClass),n.classList.remove(i.errorClass),n.textContent=""},y=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e){e.disabled=!1,e.classList.remove(i.inactiveButtonClass)}(t):_(t)},v=document.querySelector(".content"),S=v.querySelector(".places__list"),g=document.querySelectorAll(".popup"),b=v.querySelector(".profile__edit-button"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),C=document.querySelector(".profile__image-hover"),k=document.querySelector(".popup_type_new-avatar"),T=document.forms["new-avatar"],w=document.querySelector(".popup_type_edit"),x=document.forms["edit-profile"],A=v.querySelector(".profile__add-button"),z=document.querySelector(".popup_type_new-card"),P=document.forms["new-place"],B=document.querySelector(".popup_type_image"),D=B.querySelector(".popup__image"),j=B.querySelector(".popup__caption"),N=[{button:b,popupElement:w},{button:A,popupElement:z},{button:C,popupElement:k}],O=[];function I(e){return new Promise((function(t,n){var o=new Image;o.addEventListener("load",t),o.addEventListener("error",n),o.src=e}))}function J(e){o(e),function(e){if(null!==e){var t=Array.from(e.querySelectorAll(i.errorClass)),n=e.querySelector(i.submitButtonSelector),o=Array.from(e.querySelectorAll(i.inputSelector));t.forEach((function(t){h(e,t)})),o.forEach((function(e){e.value=""})),_(n)}}(e.querySelector(".popup__form"))}function H(t){return I(t.link).then((function(){return new Promise((function(n,o){t.owner._id.length>0?(S.append(e(t,U,K,F,m)),n("Card has been created")):o("no ID")}))}))}function M(t){t.owner._id.length>0&&S.prepend(e(t,U,K,F,m))}function U(e){(function(e,t){return fetch(s+"/"+e.id,{method:"DELETE",headers:{authorization:p}}).then((function(e){return f(e)})).then((function(n){t(e)}))})(e,t).catch((function(e){console.log(e)}))}function F(e){e.target.classList.contains("card__image")&&(D.src=e.currentTarget.querySelector(".card__image").src,D.alt=e.currentTarget.querySelector(".card__image").alt,j.textContent=e.currentTarget.querySelector(".card__title").textContent,r(B))}function G(e){q.textContent=e.name,L.textContent=e.about,E.style.backgroundImage="url(".concat(e.avatar,")"),m=e._id}function K(e){var t=e.querySelector(".card__like-button");t.classList.contains("card__like-button_is-active")?function(e,t){return fetch(d+"/"+e.id,{method:"DELETE",headers:{authorization:p}}).then((function(e){return f(e)})).then((function(n){t(e,n)}))}(e,Q).then((function(){n(t)})).catch((function(e){console.log(e)})):function(e,t){return fetch(d+"/"+e.id,{method:"PUT",headers:{authorization:p}}).then((function(e){return f(e)})).then((function(n){t(e,n)}))}(e,Q).then((function(){n(t)})).catch((function(e){console.log(e)}))}function Q(e,t){e.querySelector(".card__likes-counter").textContent=t.likes.length}function R(e){var t=e.querySelector(".button__submit");t.classList.toggle("saving"),t.classList.contains("saving")?(t.textContent="Сохранение...",t.classList.add("popup__button_disabled")):(t.textContent="Cохранить",t.classList.remove("popup__button_disabled"))}O.push({element:z,handler:function(e){e.preventDefault(),R(P),function(e,t,n){return fetch(s,{method:"POST",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((function(e){return f(e)})).then((function(e){n(e)}))}(P.elements["place-name"].value,P.elements.link.value,M).catch((function(e){console.log(e)})).finally((function(){R(P),J(z)}))}}),O.push({element:w,handler:function(e){e.preventDefault(),R(x),function(e,t,n){return fetch(a,{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){return f(e)})).then((function(e){console.log(e),n(e)}))}(x.elements.name.value,x.elements.description.value,G).catch((function(e){console.log(e)})).finally((function(){J(w),R(x)}))}}),O.push({element:k,handler:function(e){e.preventDefault(),R(T);var t=T.elements["avatar-link"].value;I(t).then((function(){!function(e,t){fetch(l,{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return f(e)})).then((function(e){t(e)}))}(t,G)})).catch((function(e){console.log(e)})).finally((function(){J(k),R(T)}))}}),N.forEach((function(e){e.button.addEventListener("click",(function(t){if(e.popupElement.classList.contains("popup_type_edit")){var n=document.querySelector(".profile__title"),o=document.querySelector(".profile__description");x.elements.name.value=n.textContent,x.elements.description.value=o.textContent}r(e.popupElement)}))})),g.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target===e.currentTarget)&&J(e.currentTarget)}))})),O.forEach((function(e){e.element.addEventListener("submit",e.handler)})),i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(i.formSelector)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(i.inputSelector));y(t,e.querySelector(i.submitButtonSelector)),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?h(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(i.inputErrorClass),o.textContent=n,o.classList.add(i.errorClass)}(e,t,t.validationMessage)})(e,n),y(t,e.querySelector(i.submitButtonSelector))}))}))}(e)})),function(e){return fetch(a,{headers:{authorization:p}}).then((function(e){return f(e)})).then((function(t){e(t)}))}(G).then((function(){var e;e=H,fetch(s,{headers:{authorization:p}}).then((function(e){return f(e)})).then((function(t){return Promise.all(t.map((function(t){return e(t)})))}))})).catch((function(e){console.log(e)}))})();